<% layout("layouts/main") %>
<!-- Profile Page -->
<div class="container mx-auto px-4 py-12">
  <% if (success && success.length) { %>
  <div
    class="mb-4 p-3 bg-green-100 text-green-700 rounded relative flex items-center pr-14"
    id="success-flash"
  >
    <span class="flex-1"><%= success[0] %></span>
    <span class="ml-4 relative z-10" style="margin-right: 2.5rem">
      <svg
        id="success-timer-svg"
        width="28"
        height="28"
        class="inline-block align-middle"
        style="vertical-align: middle"
      >
        <circle
          cx="14"
          cy="14"
          r="12"
          stroke="#22c55e"
          stroke-width="3"
          fill="none"
          opacity="0.2"
        />
        <circle
          id="success-timer-circle"
          cx="14"
          cy="14"
          r="12"
          stroke="#22c55e"
          stroke-width="3"
          fill="none"
          stroke-linecap="round"
          stroke-dasharray="75.4"
          stroke-dashoffset="0"
        />
      </svg>
      <span
        id="success-timer"
        class="absolute inset-0 flex items-center justify-center text-green-700 text-xs font-semibold"
      ></span>
    </span>
    <button
      type="button"
      class="absolute top-2 right-3 text-green-700 hover:text-green-900 text-xl font-bold focus:outline-none z-20"
      onclick="document.getElementById('success-flash').style.display='none'"
    >
      &times;
    </button>
  </div>
  <% } %> <% if (error && error.length) { %>
  <div
    class="mb-4 p-3 bg-red-100 text-red-700 rounded relative flex items-center pr-14"
    id="error-flash"
  >
    <span class="flex-1"><%= error[0] %></span>
    <span class="ml-4 relative z-10" style="margin-right: 2.5rem">
      <svg
        id="error-timer-svg"
        width="28"
        height="28"
        class="inline-block align-middle"
        style="vertical-align: middle"
      >
        <circle
          cx="14"
          cy="14"
          r="12"
          stroke="#ef4444"
          stroke-width="3"
          fill="none"
          opacity="0.2"
        />
        <circle
          id="error-timer-circle"
          cx="14"
          cy="14"
          r="12"
          stroke="#ef4444"
          stroke-width="3"
          fill="none"
          stroke-linecap="round"
          stroke-dasharray="75.4"
          stroke-dashoffset="0"
        />
      </svg>
      <span
        id="error-timer"
        class="absolute inset-0 flex items-center justify-center text-red-700 text-xs font-semibold"
      ></span>
    </span>
    <button
      type="button"
      class="absolute top-2 right-3 text-red-700 hover:text-red-900 text-xl font-bold focus:outline-none z-20"
      onclick="document.getElementById('error-flash').style.display='none'"
    >
      &times;
    </button>
  </div>
  <% } %>
  <script>
    window.addEventListener("DOMContentLoaded", function () {
      var duration = 20;
      function startTimer(timerElem, flashElem, circleElem) {
        if (!timerElem || !flashElem || !circleElem) return;
        var timeLeft = duration;
        var circumference = 2 * Math.PI * 12; // r=12
        timerElem.textContent = timeLeft + "s";
        circleElem.setAttribute("stroke-dasharray", circumference);
        circleElem.setAttribute("stroke-dashoffset", 0);
        var interval = setInterval(function () {
          timeLeft--;
          timerElem.textContent = timeLeft + "s";
          var offset = circumference * (1 - timeLeft / duration);
          circleElem.setAttribute("stroke-dashoffset", offset);
          if (timeLeft <= 0) {
            flashElem.style.display = "none";
            clearInterval(interval);
          }
        }, 1000);
      }
      var success = document.getElementById("success-flash");
      var error = document.getElementById("error-flash");
      var successTimer = document.getElementById("success-timer");
      var errorTimer = document.getElementById("error-timer");
      var successCircle = document.getElementById("success-timer-circle");
      var errorCircle = document.getElementById("error-timer-circle");
      if (success && successTimer && successCircle)
        startTimer(successTimer, success, successCircle);
      if (error && errorTimer && errorCircle)
        startTimer(errorTimer, error, errorCircle);
    });
  </script>
  <div
    class="bg-white shadow-xl rounded-2xl border border-gray-200 p-8 md:flex gap-10 max-w-5xl mx-auto"
  >
    <!-- Avatar -->
    <div
      class="flex flex-col items-center justify-center md:justify-start mb-6 md:mb-0"
    >
      <img
        src="<%= user.avatar %>"
        alt="Avatar"
        class="w-36 h-36 md:w-44 md:h-44 rounded-full object-cover border-4 border-blue-500 shadow-md"
      />
      <div class="mt-4 text-2xl font-bold text-gray-900"><%= user.name %></div>
      <div class="text-gray-500 text-base">@<%= user.username %></div>
    </div>

    <!-- User Info -->
    <div class="flex-1 space-y-6">
      <!-- Grid Info -->
      <div class="grid sm:grid-cols-2 gap-4 text-gray-700">
        <p>
          <strong>Email:</strong>
          <span class="font-medium"><%= user.email %></span>
        </p>

        <% if (user.phone) { %>
        <p>
          <strong>Phone:</strong>
          <span class="font-medium"><%= user.phone %></span>
        </p>
        <% } %> <% if (user.role) { %>
        <p>
          <strong>Role:</strong>
          <span class="font-medium capitalize"><%= user.role %></span>
        </p>
        <% } %> <% if (user.roleRequest) { %>
        <p>
          <strong>Role Requested:</strong>
          <span class="font-medium capitalize"><%= user.roleRequest %></span>
        </p>
        <% } %> <% if (user.bio) { %>
        <p class="sm:col-span-2">
          <strong>Bio:</strong> <span class="font-medium"><%= user.bio %></span>
        </p>
        <% } %>
      </div>

      <!-- Social Links -->
      <% if (user.socials && (user.socials.linkedin || user.socials.github ||
      user.socials.behance)) { %>
      <div>
        <h2 class="text-lg font-semibold text-gray-800 mb-2">Social Links</h2>
        <div class="flex flex-wrap gap-3">
          <% if (user.socials.linkedin) { %>
          <a
            href="<%= user.socials.linkedin %>"
            target="_blank"
            class="text-blue-600 hover:underline"
            >LinkedIn</a
          >
          <% } %> <% if (user.socials.github) { %>
          <a
            href="<%= user.socials.github %>"
            target="_blank"
            class="text-gray-900 hover:underline"
            >GitHub</a
          >
          <% } %> <% if (user.socials.behance) { %>
          <a
            href="<%= user.socials.behance %>"
            target="_blank"
            class="text-indigo-600 hover:underline"
            >Behance</a
          >
          <% } %>
        </div>
      </div>
      <% } %>

      <!-- Buttons -->
      <div class="flex flex-col sm:flex-row gap-4 pt-4">
        <a
          href="/user/<%= user.username %>/edit"
          class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-lg text-center shadow hover:shadow-lg transition"
        >
          Edit Profile
        </a>
        <a
          href="/user/<%= user.username %>/request-role"
          class="bg-gray-800 hover:bg-gray-900 text-white py-2 px-6 rounded-lg text-center shadow hover:shadow-lg transition"
        >
          Request Role
        </a>
      </div>
    </div>
  </div>
</div>
